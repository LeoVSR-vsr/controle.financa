<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#2c3e50">
    <title>Meu Financeiro v9</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { 
            --bg: #f8f9fa; --primary: #2c3e50; --green: #2ecc71; 
            --red: #e74c3c; --blue: #3498db; --orange: #f39c12; --purple: #9b59b6; 
        }

        * { -webkit-tap-highlight-color: transparent; user-select: none; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            background: var(--bg); margin: 0; padding-bottom: 80px; color: #333; 
        }

        /* Menu Inferior */
        nav { 
            background: var(--primary); display: flex; justify-content: space-around; 
            position: fixed; bottom: 0; width: 100%; padding: 12px 0; 
            z-index: 2000; box-shadow: 0 -2px 10px rgba(0,0,0,0.2); 
        }
        nav button { background: none; color: white; border: none; font-size: 11px; display: flex; flex-direction: column; align-items: center; gap: 5px; opacity: 0.8; }
        nav button.active-nav { opacity: 1; font-weight: bold; }

        /* Cabe√ßalho e Term√¥metro */
        .header-app { background: white; padding: 15px; border-radius: 0 0 20px 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 100; }
        .termometro-track { background: #eee; height: 10px; border-radius: 10px; overflow: hidden; margin: 8px 0; }
        .termometro-bar { height: 100%; width: 0%; transition: 1s ease; }
        
        /* Grid de Cards com Legenda */
        .resumo { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 15px; }
        .card { padding: 12px; border-radius: 15px; color: white; display: flex; flex-direction: column; align-items: center; justify-content: center; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .card span { font-size: 10px; font-weight: bold; text-transform: uppercase; margin-bottom: 4px; opacity: 0.9; }
        .card strong { font-size: 15px; }
        .full-card { grid-column: span 2; padding: 18px; }
        .full-card strong { font-size: 22px; }

        .secao { padding: 20px; display: none; }
        .active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        input, select { width: 100%; padding: 14px; margin: 8px 0; border: 1px solid #ddd; border-radius: 12px; font-size: 16px; -webkit-appearance: none; }
        .btn-principal { background: var(--green); color: white; border: none; padding: 16px; width: 100%; border-radius: 12px; font-weight: bold; font-size: 16px; margin-top: 10px; }

        /* Itens da Lista */
        .transacao-item { background: white; padding: 15px; border-radius: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border-left: 5px solid transparent; }
        .item-receita { border-left-color: var(--green); }
        .item-despesa { border-left-color: var(--red); }
        .badge { font-size: 10px; padding: 2px 8px; border-radius: 6px; background: #f0f0f0; color: #777; font-weight: bold; }
        
        .meta-box { background: white; padding: 15px; border-radius: 15px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.03); }
    </style>
</head>
<body onload="iniciar()">

    <div class="header-app">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <small id="texto-saude" style="font-weight: 800; color: var(--primary);">SA√öDE FINANCEIRA</small>
            <input type="month" id="filtroMes" onchange="renderizarTudo()" style="width: auto; padding: 4px; margin: 0; border: none; font-weight: bold; background: #f0f0f0; border-radius: 8px;">
        </div>
        <div class="termometro-track"><div id="termometro-fill" class="termometro-bar"></div></div>
    </div>

    <div class="resumo">
        <div class="card full-card" style="background: var(--orange)" id="card-real">
            <span>Dispon√≠vel (Saldo Real)</span>
            <strong id="val-real">R$ 0,00</strong>
        </div>
        <div class="card" style="background: var(--blue)">
            <span>Saldo Total</span>
            <strong id="val-total">R$ 0,00</strong>
        </div>
        <div class="card" style="background: var(--purple)">
            <span>Em Metas</span>
            <strong id="val-metas">R$ 0,00</strong>
        </div>
        <div class="card" style="background: var(--green)">
            <span>Ganhos (M√™s)</span>
            <strong id="val-receita">R$ 0,00</strong>
        </div>
        <div class="card" style="background: var(--red)">
            <span>Gastos (M√™s)</span>
            <strong id="val-despesa">R$ 0,00</strong>
        </div>
    </div>

    <section id="aba-extrato" class="secao active">
        <select id="filtroCat" onchange="renderizarTudo()" style="margin-bottom: 15px;"></select>
        <div id="corpo-lista"></div>
    </section>

    <section id="aba-novo" class="secao">
        <h3 style="margin-top:0">Novo Lan√ßamento</h3>
        <select id="tipo"><option value="despesa">üî¥ Despesa</option><option value="receita">üü¢ Receita</option></select>
        <input type="date" id="data">
        <input type="text" id="desc" placeholder="Descri√ß√£o">
        <input type="number" id="valor" placeholder="Valor R$">
        <select id="cat-select"></select>
        <label style="display:flex; align-items:center; gap:10px; padding:15px; background: #fff; border-radius: 12px; margin-top: 10px;">
            <input type="checkbox" id="fixo" style="width:auto"> Conta Fixa (Todo m√™s)
        </label>
        <button class="btn-principal" onclick="salvarLancamento()">SALVAR</button>
    </section>

    <section id="aba-metas" class="secao">
        <h3 style="margin-top:0">Metas e Objetivos</h3>
        <input type="text" id="m-nome" placeholder="Nome da Meta">
        <input type="number" id="m-alvo" placeholder="Valor Alvo R$">
        <button class="btn-principal" onclick="criarMeta()" style="background: var(--purple)">CRIAR META</button>
        <div id="container-metas" style="margin-top: 20px;"></div>
    </section>

    <section id="aba-grafico" class="secao">
        <h3>Distribui√ß√£o de Gastos</h3>
        <canvas id="canvasGrafico"></canvas>
    </section>

    <section id="aba-config" class="secao">
        <h3>Configura√ß√µes</h3>
        <div class="meta-box">
            <h4>Gerenciar Categorias</h4>
            <div style="display:flex; gap:5px">
                <input type="text" id="nova-cat" placeholder="Nova Categoria" style="margin:0">
                <button onclick="adicionarCategoria()" style="background:var(--primary); color:white; border:none; border-radius:10px; padding:0 15px">ADD</button>
            </div>
            <div id="lista-cats-config" style="margin-top:15px; display: flex; flex-wrap: wrap; gap: 5px;"></div>
        </div>
        <button onclick="resetTotal()" style="background:none; color:var(--red); border:2px solid var(--red); width:100%; padding:15px; border-radius: 12px; font-weight: bold; margin-top: 20px;">Zerar Todos os Dados</button>
    </section>

    <nav id="app-nav">
        <button onclick="mudarAba('aba-extrato')" class="active-nav"><span>üìã</span>Extrato</button>
        <button onclick="mudarAba('aba-novo')"><span>üí∞</span>Lan√ßar</button>
        <button onclick="mudarAba('aba-metas')"><span>üöÄ</span>Metas</button>
        <button onclick="mudarAba('aba-grafico')"><span>üìä</span>Gr√°fico</button>
        <button onclick="mudarAba('aba-config')"><span>‚öôÔ∏è</span>Ajustes</button>
    </nav>

    <script>
        const DB_KEY = 'FINANCAS_MOBILE_V9';
        let db = JSON.parse(localStorage.getItem(DB_KEY)) || { transacoes: [], metas: [], categorias: ["Alimenta√ß√£o", "Moradia", "Transporte", "Lazer", "Sa√∫de"] };

        function iniciar() {
            const hoje = new Date();
            document.getElementById('data').valueAsDate = hoje;
            document.getElementById('filtroMes').value = hoje.toISOString().substring(0, 7);
            processarFixos();
            renderizarTudo();
        }

        function mudarAba(id) {
            document.querySelectorAll('.secao').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('#app-nav button').forEach(b => b.classList.remove('active-nav'));
            document.getElementById(id).classList.add('active');
            event.currentTarget.classList.add('active-nav');
            if(id === 'aba-grafico') desenharGrafico();
            window.scrollTo(0,0);
        }

        function salvarLancamento() {
            const desc = document.getElementById('desc').value;
            const valor = parseFloat(document.getElementById('valor').value);
            if(!desc || isNaN(valor)) return alert("Preencha descri√ß√£o e valor!");
            db.transacoes.push({
                id: Date.now(),
                tipo: document.getElementById('tipo').value,
                data: document.getElementById('data').value,
                desc, valor,
                categoria: document.getElementById('cat-select').value,
                fixo: document.getElementById('fixo').checked
            });
            salvar();
            renderizarTudo();
            mudarAba('aba-extrato');
            document.getElementById('desc').value = '';
            document.getElementById('valor').value = '';
        }

        function renderizarTudo() {
            renderizarCategorias();
            const mes = document.getElementById('filtroMes').value;
            const fCat = document.getElementById('filtroCat').value;
            const listaMes = db.transacoes.filter(t => t.data.startsWith(mes) && (fCat === "" || t.categoria === fCat));

            const totRec = db.transacoes.filter(t => t.tipo === 'receita').reduce((s, t) => s + t.valor, 0);
            const totDes = db.transacoes.filter(t => t.tipo === 'despesa').reduce((s, t) => s + t.valor, 0);
            const emMetas = db.metas.reduce((s, m) => s + (m.atual || 0), 0);
            const recMes = listaMes.filter(t => t.tipo === 'receita').reduce((s, t) => s + t.valor, 0);
            const desMes = listaMes.filter(t => t.tipo === 'despesa').reduce((s, t) => s + t.valor, 0);

            // Interface com Legendas
            document.getElementById('val-real').innerText = `R$ ${(totRec - totDes - emMetas).toFixed(2)}`;
            document.getElementById('val-total').innerText = `R$ ${(totRec - totDes).toFixed(2)}`;
            document.getElementById('val-metas').innerText = `R$ ${emMetas.toFixed(2)}`;
            document.getElementById('val-receita').innerText = `R$ ${recMes.toFixed(2)}`;
            document.getElementById('val-despesa').innerText = `R$ ${desMes.toFixed(2)}`;

            // Sa√∫de Financeira
            const pct = recMes > 0 ? (desMes / recMes) * 100 : (desMes > 0 ? 100 : 0);
            const fill = document.getElementById('termometro-fill');
            fill.style.width = Math.min(pct, 100) + '%';
            fill.style.background = pct < 70 ? 'var(--green)' : (pct <= 100 ? 'var(--orange)' : 'var(--red)');
            document.getElementById('texto-saude').innerText = pct > 100 ? "NO VERMELHO! üö®" : (pct > 70 ? "ATEN√á√ÉO! ‚ö†Ô∏è" : "SA√öDE EXCELENTE! ‚úÖ");

            document.getElementById('corpo-lista').innerHTML = listaMes.sort((a,b) => b.id - a.id).map(t => `
                <div class="transacao-item ${t.tipo==='receita'?'item-receita':'item-despesa'}">
                    <div>
                        <strong>${t.desc}</strong><br>
                        <span class="badge">${t.categoria}</span> ${t.fixo?'<span class="badge" style="background:var(--purple);color:white">FIXO</span>':''}
                    </div>
                    <div style="text-align:right">
                        <span style="color:${t.tipo==='receita'?'var(--green)':'var(--red)'}; font-weight:bold">
                            ${t.tipo==='receita'?'+':'-'} R$ ${t.valor.toFixed(2)}
                        </span><br>
                        <small onclick="removerT(${t.id})" style="color:#bbb; font-size:10px">EXCLUIR</small>
                    </div>
                </div>
            `).join('');
            renderMetas();
        }

        function renderMetas() {
            document.getElementById('container-metas').innerHTML = db.metas.map(m => `
                <div class="meta-box">
                    <div style="display:flex; justify-content:space-between"><strong>${m.nome}</strong> <span>R$ ${m.atual.toFixed(2)}</span></div>
                    <div class="termometro-track"><div style="width:${Math.min((m.atual/m.alvo)*100, 100)}%; background:var(--purple); height:100%"></div></div>
                    <div style="display:flex; gap:8px">
                        <input type="number" id="in-${m.id}" placeholder="Somar R$" style="margin:0; flex:1; padding:10px">
                        <button onclick="somarMeta(${m.id})" style="background:var(--green); color:white; border:none; border-radius:10px; padding:0 20px; font-weight:bold">+</button>
                        <button onclick="removerM(${m.id})" style="border:none; background:none; font-size:18px">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        function processarFixos() {
            const mesAtual = document.getElementById('filtroMes').value;
            db.transacoes.filter(t => t.fixo).forEach(f => {
                const dataBase = f.data.substring(0, 7);
                if (dataBase < mesAtual) {
                    const novaData = mesAtual + f.data.substring(7);
                    if (!db.transacoes.find(t => t.desc === f.desc && t.data === novaData)) {
                        db.transacoes.push({ ...f, id: Date.now() + Math.random(), data: novaData });
                    }
                }
            });
            salvar();
        }

        function renderizarCategorias() {
            const selects = ['cat-select', 'filtroCat'];
            selects.forEach(sId => {
                const s = document.getElementById(sId);
                const val = s.value;
                s.innerHTML = (sId === 'filtroCat' ? '<option value="">Filtrar Categoria</option>' : '') + 
                    db.categorias.map(c => `<option value="${c}">${c}</option>`).join('');
                s.value = val;
            });
            document.getElementById('lista-cats-config').innerHTML = db.categorias.map(c => `
                <div class="badge" style="padding:8px 12px; display:flex; align-items:center; gap:8px">
                    ${c} <span onclick="removerCat('${c}')" style="color:var(--red); font-size:14px">√ó</span>
                </div>`).join('');
        }

        function adicionarCategoria() {
            const n = document.getElementById('nova-cat').value.trim();
            if(n && !db.categorias.includes(n)) { db.categorias.push(n); salvar(); renderizarCategorias(); document.getElementById('nova-cat').value=''; }
        }

        function removerCat(c) { if(confirm("Excluir categoria?")) { db.categorias = db.categorias.filter(x => x !== c); salvar(); renderizarCategorias(); } }
        function somarMeta(id) { const v = parseFloat(document.getElementById(`in-${id}`).value); if(v > 0) { db.metas.find(m => m.id === id).atual += v; salvar(); renderizarTudo(); } }
        function criarMeta() { const n = document.getElementById('m-nome').value; const a = parseFloat(document.getElementById('m-alvo').value); if(n && a) { db.metas.push({id:Date.now(), nome:n, alvo:a, atual:0}); salvar(); renderizarTudo(); } }
        function removerT(id) { if(confirm("Excluir este lan√ßamento?")) { db.transacoes = db.transacoes.filter(t => t.id !== id); salvar(); renderizarTudo(); } }
        function removerM(id) { if(confirm("Excluir meta?")) { db.metas = db.metas.filter(m => m.id !== id); salvar(); renderizarTudo(); } }
        function salvar() { localStorage.setItem(DB_KEY, JSON.stringify(db)); }
        function resetTotal() { if(confirm("APAGAR TUDO? Esta a√ß√£o √© irrevers√≠vel.")) { localStorage.clear(); location.reload(); } }
        
        function desenharGrafico() {
            const ctx = document.getElementById('canvasGrafico').getContext('2d');
            const mes = document.getElementById('filtroMes').value;
            const gastos = db.transacoes.filter(t => t.data.startsWith(mes) && t.tipo === 'despesa');
            const totais = {};
            gastos.forEach(g => totais[g.categoria] = (totais[g.categoria] || 0) + g.valor);
            if(window.myChart) window.myChart.destroy();
            window.myChart = new Chart(ctx, { 
                type: 'doughnut', 
                data: { labels: Object.keys(totais), datasets: [{ data: Object.values(totais), backgroundColor: ['#3498db','#e74c3c','#2ecc71','#f1c40f','#9b59b6','#e67e22'] }] },
                options: { plugins: { legend: { position: 'bottom' } } }
            });
        }
    </script>
</body>
</html>
